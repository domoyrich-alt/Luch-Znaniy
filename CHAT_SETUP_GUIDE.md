# üöÄ –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ —á–∞—Ç–∞–º–∏

## –ß—Ç–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ ‚úÖ

### Backend (Node.js + Express + PostgreSQL)
- ‚úÖ **3 –Ω–æ–≤—ã–µ —Ç–∞–±–ª–∏—Ü—ã –ë–î:**
  - `user_profiles` - –ø—Ä–æ—Ñ–∏–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å username
  - `private_chats` - –ø—Ä–∏–≤–∞—Ç–Ω—ã–µ —á–∞—Ç—ã –º–µ–∂–¥—É –¥–≤—É–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
  - `private_messages` - —Å–æ–æ–±—â–µ–Ω–∏—è —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π —Ç–µ–∫—Å—Ç–∞, —Ñ–æ—Ç–æ, –≤–∏–¥–µ–æ

- ‚úÖ **API endpoints:**
  - –ü–æ–∏—Å–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø–æ username (`/api/users/search`)
  - –ü—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (`/api/user/:id/profile`)
  - –°–æ–∑–¥–∞–Ω–∏–µ/–ø–æ–ª—É—á–µ–Ω–∏–µ —á–∞—Ç–æ–≤ (`/api/chats/private`)
  - –°–æ–æ–±—â–µ–Ω–∏—è —Å –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π (`/api/chats/:chatId/messages`)
  - –û—Ç–ø—Ä–∞–≤–∫–∞ —Ç–µ–∫—Å—Ç–∞, —Ñ–æ—Ç–æ, –≤–∏–¥–µ–æ
  - –û—Ç–º–µ—Ç–∫–∞ –∫–∞–∫ –ø—Ä–æ—á–∏—Ç–∞–Ω–æ
  - –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤ —Å multer (`/api/upload`)

### Frontend (React Native)
- ‚úÖ **ChatService** - —Å–µ—Ä–≤–∏—Å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å API
- ‚úÖ **–û–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–µ —ç–∫—Ä–∞–Ω—ã:**
  - `ChatsListScreen` - —Ä–µ–∞–ª—å–Ω—ã–µ —á–∞—Ç—ã –∏–∑ –ë–î + –ø–æ–∏—Å–∫ + refresh
  - `NewChatScreen` - –ø–æ–∏—Å–∫ –ø–æ username + —Å–æ–∑–¥–∞–Ω–∏–µ —á–∞—Ç–∞
  - `ChatScreenNew` - —Ç–µ–∫—Å—Ç, —Ñ–æ—Ç–æ, –≤–∏–¥–µ–æ + real-time –æ—Ç–ø—Ä–∞–≤–∫–∞
- ‚úÖ **–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å:**
  - –ü–æ–∏—Å–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
  - –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–∏–≤–∞—Ç–Ω—ã—Ö —á–∞—Ç–æ–≤
  - –û—Ç–ø—Ä–∞–≤–∫–∞ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
  - –ó–∞–≥—Ä—É–∑–∫–∞ –∏ –æ—Ç–ø—Ä–∞–≤–∫–∞ —Ñ–æ—Ç–æ
  - –ó–∞–≥—Ä—É–∑–∫–∞ –∏ –æ—Ç–ø—Ä–∞–≤–∫–∞ –≤–∏–¥–µ–æ
  - –û—Ç–º–µ—Ç–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π –∫–∞–∫ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã—Ö

## –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –ë–î

### 1. –°–æ–∑–¥–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é
```bash
cd c:\Attached-Assets\Attached-Assets
npm run db:push
```

### 2. –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ —Ç–∞–±–ª–∏—Ü—ã —Å–æ–∑–¥–∞–Ω—ã
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤ –≤–∞—à–µ–π PostgreSQL –ë–î
\dt private_chats
\dt private_messages
\dt user_profiles
```

## –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

### 1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (—É–∂–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã)
```bash
npm install
```

### 2. –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–µ—Ä
```bash
npm run server:dev
```
–°–µ—Ä–≤–µ—Ä –∑–∞–ø—É—Å—Ç–∏—Ç—Å—è –Ω–∞ `http://localhost:5000`

### 3. –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ (–≤ –¥—Ä—É–≥–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ)
```bash
npm run expo:dev
```

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ (–¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)

### 1Ô∏è‚É£ –õ–æ–≥–∏–Ω –ø–µ—Ä–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –ö–æ–¥: `STUDENT-ABC123` (–∏–ª–∏ –ª—é–±–æ–π —Å –ø—Ä–µ—Ñ–∏–∫—Å–æ–º CLASS)
- –ò–º—è: `–ê–ª–µ–∫—Å`
- –§–∞–º–∏–ª–∏—è: `–ò–≤–∞–Ω–æ–≤`

### 2Ô∏è‚É£ –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è –≤—Ç–æ—Ä–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
–ü–æ—Å–ª–µ –≤—Ö–æ–¥–∞, –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ (–∏–ª–∏ API):
```bash
curl -X PATCH http://localhost:5000/api/user/1/profile \
  -H "Content-Type: application/json" \
  -d '{
    "username": "alex_ivanov",
    "bio": "–°—Ç—É–¥–µ–Ω—Ç 11–ê",
    "status": "–£—á—É—Å—å"
  }'
```

### 3Ô∏è‚É£ –õ–æ–≥–∏–Ω –≤—Ç–æ—Ä–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –ö–æ–¥: `STUDENT-XYZ789`
- –ò–º—è: `–ú–∞—Ä–∏—è`
- –§–∞–º–∏–ª–∏—è: `–ü–µ—Ç—Ä–æ–≤–∞`

### 4Ô∏è‚É£ –û—Ç–∫—Ä—ã—Ç—å –ß–∞—Ç—ã ‚Üí "+"
- –í–≤–µ—Å—Ç–∏ username: `alex_ivanov`
- –ù–∞–∂–∞—Ç—å –ü–æ–∏—Å–∫
- –í—ã–±—Ä–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –û—Ç–∫—Ä—ã–ª—Å—è —á–∞—Ç!

### 5Ô∏è‚É£ –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ
- –í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –∏ –Ω–∞–∂–º–∏—Ç–µ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å ‚úàÔ∏è
- –î–æ–±–∞–≤—å—Ç–µ —Ñ–æ—Ç–æ üì∏ –∏–ª–∏ –≤–∏–¥–µ–æ üé•

## –î–µ–º–æ API (curl)

### –ü–æ–∏—Å–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
```bash
curl http://localhost:5000/api/users/search?query=alex
```

### –°–æ–∑–¥–∞—Ç—å —á–∞—Ç
```bash
curl -X POST http://localhost:5000/api/chats/private \
  -H "Content-Type: application/json" \
  -d '{"user1Id": 1, "user2Id": 2}'
```

### –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ
```bash
curl -X POST http://localhost:5000/api/chats/1/messages \
  -H "Content-Type: application/json" \
  -d '{
    "senderId": 1,
    "message": "Hello!"
  }'
```

### –ü–æ–ª—É—á–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è
```bash
curl http://localhost:5000/api/chats/1/messages?limit=50
```

### –ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–æ—Ç–æ
```bash
curl -X POST http://localhost:5000/api/upload \
  -F "file=@photo.jpg"
```

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
server/
‚îú‚îÄ‚îÄ routes.ts ‚Üê API endpoints (–Ω–æ–≤—ã–µ: /api/users/search, /api/chats/private, etc)
‚îú‚îÄ‚îÄ storage.ts ‚Üê –ë–î –º–µ—Ç–æ–¥—ã (–Ω–æ–≤—ã–µ: getUserProfile, sendPrivateMessage, etc)
‚îú‚îÄ‚îÄ db.ts
‚îî‚îÄ‚îÄ index.ts

client/
‚îú‚îÄ‚îÄ screens/
‚îÇ   ‚îú‚îÄ‚îÄ ChatsListScreen.tsx ‚Üê —Ä–µ–∞–ª—å–Ω—ã–µ —á–∞—Ç—ã –∏–∑ API
‚îÇ   ‚îú‚îÄ‚îÄ ChatScreenNew.tsx ‚Üê —Ç–µ–∫—Å—Ç + —Ñ–æ—Ç–æ + –≤–∏–¥–µ–æ
‚îÇ   ‚îî‚îÄ‚îÄ NewChatScreen.tsx ‚Üê –ø–æ–∏—Å–∫ –ø–æ username
‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îî‚îÄ‚îÄ ChatService.ts ‚Üê –∫–ª–∏–µ–Ω—Ç—Å–∫–∏–π API —Å–µ—Ä–≤–∏—Å (–ù–û–í–´–ô)
‚îî‚îÄ‚îÄ navigation/
    ‚îî‚îÄ‚îÄ ChatsStackNavigator.tsx

shared/
‚îî‚îÄ‚îÄ schema.ts ‚Üê —Ç–∏–ø—ã –ë–î (–Ω–æ–≤—ã–µ —Ç–∞–±–ª–∏—Ü—ã)
```

## –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

### –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è:
```
User 1 –≤–≤–æ–¥–∏—Ç —Ç–µ–∫—Å—Ç ‚Üí –ù–∞–∂–∏–º–∞–µ—Ç Send ‚Üí ChatService.sendMessage() 
‚Üí POST /api/chats/:chatId/messages ‚Üí Server —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ private_messages 
‚Üí –°–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è User 2
```

### –ü–æ–∏—Å–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:
```
User 1 –≤–≤–æ–¥–∏—Ç "alex" ‚Üí –ù–∞–∂–∏–º–∞–µ—Ç –ü–æ–∏—Å–∫ ‚Üí ChatService.searchUsers("alex")
‚Üí GET /api/users/search?query=alex ‚Üí SELECT * FROM user_profiles WHERE username ILIKE 'alex'
‚Üí –ü–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
```

### –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–æ—Ç–æ:
```
User 1 –≤—ã–±–∏—Ä–∞–µ—Ç —Ñ–æ—Ç–æ ‚Üí ChatService.uploadFile(uri, name)
‚Üí POST /api/upload (multipart) ‚Üí Multer —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ /uploads/
‚Üí –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç fileUrl ‚Üí ChatService.sendMediaMessage(fileUrl, "photo", ...)
‚Üí –°–æ–æ–±—â–µ–Ω–∏–µ —Å —Ñ–æ—Ç–æ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è
```

## –û—à–∏–±–∫–∏ –∏ —Ä–µ—à–µ–Ω–∏—è

### "–¢–∞–±–ª–∏—Ü—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã"
```bash
npm run db:push  # –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏
```

### "Multer: —Ñ–∞–π–ª –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω"
```bash
# –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –ø–∞–ø–∫–∞ uploads —Å–æ–∑–¥–∞–Ω–∞
mkdir uploads
```

### "ChatService –Ω–µ –Ω–∞–π–¥–µ–Ω"
```bash
# –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ —Ñ–∞–π–ª exists:
ls client/services/ChatService.ts
```

### –û—à–∏–±–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ DATABASE_URL
echo $DATABASE_URL

# –î–æ–ª–∂–Ω–æ –±—ã—Ç—å: postgresql://user:password@localhost:5432/dbname
```

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

- [ ] WebSockets –¥–ª—è real-time —Å–æ–æ–±—â–µ–Ω–∏–π (–≤–º–µ—Å—Ç–æ polling)
- [ ] –ì—Ä—É–ø–ø–æ–≤—ã–µ —á–∞—Ç—ã
- [ ] –†–µ–∞–∫—Ü–∏–∏ –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏—è (üòÄ ‚ù§Ô∏è üòÇ)
- [ ] –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π
- [ ] –£–¥–∞–ª–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π
- [ ] –ì–æ–ª–æ—Å–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
- [ ] –û–Ω–ª–∞–π–Ω —Å—Ç–∞—Ç—É—Å (real-time)
- [ ] Typing indicator ("...–ø–µ—á–∞—Ç–∞–µ—Ç")
