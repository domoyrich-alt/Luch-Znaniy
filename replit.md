# Luch Znaniy - School Management Mobile App

## Overview

Luch Znaniy is a comprehensive school management mobile application built with React Native (Expo) and Express.js. The app provides a unified platform for students, teachers, directors, and curators to manage academic activities including attendance tracking, grades, homework, cafeteria services, and school events. The system uses role-based access control with invite codes for class enrollment and supports both even/odd week scheduling common in educational institutions.

## User Preferences

Preferred communication style: Simple, everyday language.

## System Architecture

### Frontend Architecture
- **Framework**: React Native with Expo SDK 54 (new architecture enabled)
- **Navigation**: React Navigation v7 with a hybrid structure:
  - Bottom tab navigator for main sections (Home, Schedule, Check-In, Cafeteria, Profile)
  - Native stack navigators for each tab's screen hierarchy
  - Modal presentations for secondary content (Homework, Events, Announcements)
- **State Management**: 
  - React Context for auth state (`AuthContext`) and app data (`AppContext`)
  - TanStack React Query for server state management
- **Styling**: Custom theming system with light/dark mode support, consistent spacing/border radius tokens
- **Animations**: React Native Reanimated for smooth UI interactions

### Backend Architecture
- **Framework**: Express.js with TypeScript
- **Database**: PostgreSQL with Drizzle ORM
- **API Design**: RESTful endpoints prefixed with `/api`
- **Storage**: Abstracted storage interface (`IStorage`) with in-memory implementation for development

### Authentication Flow
- Invite code-based enrollment connected to PostgreSQL database
- Seven user roles: Student, Teacher, Director, Curator, Cook, CEO, Parent
- Real API authentication via `/api/auth/login` endpoint
- First name and last name are required during registration
- Hardcoded special codes:
  - CEO Master: CEO-MASTER-2024 (full system access)
  - Parent: PARENT-2024 (shared code for monitoring children)
- Hierarchical invite code generation: CEO → Director → Teacher → Student
- Valid invite codes seeded in database:
  - Students: dynamically generated by teachers
  - Director: dynamically generated by CEO
  - Teachers: dynamically generated by directors
  - Curators: CURATOR-CLASS9-001, CURATOR-CLASS10-001, etc.
  - Cooks: COOK-MENU-001

### Role-Based Permissions
- **Students**: Read-only access (view grades, schedule, events, cafeteria menu)
- **Teachers**: Edit schedule, class composition, events, homework, grades, create student invite codes
- **Curators**: Edit schedule, class composition, manage events, announcements, homework, grades  
- **Directors**: Full access to all features including cafeteria menu editing, create teacher invite codes
- **Cooks**: Edit cafeteria menu only
- **CEO**: Master access to everything, create director invite codes
- **Parent**: View-only access to linked child's data

### Key Design Patterns
- Path aliases (`@/` for client, `@shared/` for shared code)
- Shared schema definitions between frontend and backend using Drizzle + Zod
- Component-based UI with reusable themed components (ThemedText, ThemedView, Card, Button)
- Error boundary pattern for graceful error handling

### Project Structure
```
client/           # React Native app code
  components/     # Reusable UI components
  screens/        # Screen components
  navigation/     # Navigation configuration
  context/        # React Context providers
  hooks/          # Custom React hooks
  constants/      # Theme and design tokens
  lib/            # Utilities (API client, query client)
server/           # Express.js backend
  routes.ts       # API route definitions
  db.ts           # Database connection
  storage.ts      # Data storage abstraction
shared/           # Shared code (schema definitions)
```

## External Dependencies

### Database
- **PostgreSQL**: Primary database (configured via `DATABASE_URL` environment variable)
- **Drizzle ORM**: Type-safe database queries with schema validation via drizzle-zod

### Mobile Platform
- **Expo**: Managed workflow with custom native modules
- **Expo Modules**: blur, haptics, image, linear-gradient, splash-screen, status-bar, web-browser

### Key Libraries
- **React Navigation**: Tab and stack navigation
- **TanStack React Query**: Server state caching and synchronization
- **React Native Reanimated**: High-performance animations
- **React Native Gesture Handler**: Touch gesture handling
- **Zod**: Runtime type validation for API schemas

### Development Tools
- **TypeScript**: Full type safety across frontend and backend
- **ESLint + Prettier**: Code quality and formatting
- **esbuild**: Server bundling for production
- **tsx**: TypeScript execution for development server

## Recent Changes (December 2024)

### API Integration Complete
- **AuthContext**: Updated to use real API authentication with async login/logout
- **AppContext**: Migrated from mock data to real API fetching for all data (grades, homework, events, news, cafeteria, schedule)
- **InviteCodeScreen**: Enhanced with error handling, loading states, and optional name fields
- **GradesScreen**: Now displays real grades from database with proper loading and empty states
- **CafeteriaScreen**: Updated to use new menu format with availability toggle (no prices displayed)

### Homework Management (December 10, 2024)
- **HomeworkModal**: Teachers, curators, and directors can now create homework assignments
- Add homework UI with subject selection, title, description, and due date fields
- Fixed subject/homework loading for non-student users (defaults to class 11)
- Error handling with user-friendly alerts

### Database Schema
- All tables created: users, classes, grades, homework, events, news, schedule, cafeteria_menu, attendance, subjects
- Sample data seeded: 57 subjects across 11 classes, 17 cafeteria menu items
- Invite codes seeded for all roles and classes

### API Endpoints
- Authentication: `/api/auth/login`
- Grades: `/api/grades/:studentId`
- Homework: `/api/homework/:classId` (GET), `/api/homework` (POST)
- Events: `/api/events`
- News: `/api/news`
- Cafeteria: `/api/cafeteria` (CRUD operations)
- Schedule: `/api/schedule/:classId`
- Subjects: `/api/subjects/:classId`
- Leaderboard: `/api/leaderboard/:level` (junior/middle/senior)
- Class Chat: `/api/class-chat/:classId` (GET, POST)
- Achievements: `/api/achievements/:studentId` (GET), `/api/achievements/:studentId/calculate` (POST)
- Invite Codes: `/api/invite-codes` (POST - create new invite code)

### New Screens (December 11, 2024)
- **LeaderboardScreen**: Grade competition by school level (junior 1-4, middle 5-8, senior 9-11)
- **ClassChatScreen**: Class-specific messaging with student list
- **AdminScreen**: Hierarchical invite code generation for authorized roles
- **ProfileScreen**: Updated with navigation buttons to new screens and real achievements from API