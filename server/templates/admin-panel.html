<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Луч Знаний - Панель директора</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
      background: linear-gradient(135deg, #0a0a1a 0%, #1a1a3a 50%, #0f0f2a 100%);
      min-height: 100vh;
      color: #ffffff;
      overflow-x: hidden;
    }

    .background-orbs {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 0;
      overflow: hidden;
    }

    .orb {
      position: absolute;
      border-radius: 50%;
      filter: blur(80px);
      opacity: 0.4;
      animation: float 8s ease-in-out infinite;
    }

    .orb-1 {
      width: 400px;
      height: 400px;
      background: radial-gradient(circle, #7c3aed 0%, transparent 70%);
      top: -100px;
      right: -100px;
      animation-delay: 0s;
    }

    .orb-2 {
      width: 350px;
      height: 350px;
      background: radial-gradient(circle, #06b6d4 0%, transparent 70%);
      bottom: -50px;
      left: -100px;
      animation-delay: -2s;
    }

    .orb-3 {
      width: 300px;
      height: 300px;
      background: radial-gradient(circle, #ec4899 0%, transparent 70%);
      top: 40%;
      left: 20%;
      animation-delay: -4s;
    }

    @keyframes float {
      0%, 100% { transform: translateY(0) scale(1); }
      50% { transform: translateY(-30px) scale(1.05); }
    }

    .container {
      position: relative;
      z-index: 1;
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 20px 0;
      margin-bottom: 40px;
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .logo-icon {
      width: 48px;
      height: 48px;
      background: linear-gradient(135deg, #7c3aed, #06b6d4);
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
      box-shadow: 0 0 30px rgba(124, 58, 237, 0.5);
    }

    .logo-text {
      font-size: 24px;
      font-weight: 700;
      background: linear-gradient(135deg, #7c3aed, #06b6d4);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .nav-buttons {
      display: flex;
      gap: 12px;
    }

    .btn {
      padding: 12px 24px;
      border-radius: 12px;
      font-weight: 600;
      font-size: 14px;
      cursor: pointer;
      transition: all 0.3s ease;
      border: none;
      font-family: inherit;
    }

    .btn-outline {
      background: transparent;
      border: 2px solid rgba(124, 58, 237, 0.5);
      color: #7c3aed;
    }

    .btn-outline:hover {
      background: rgba(124, 58, 237, 0.1);
      border-color: #7c3aed;
      box-shadow: 0 0 20px rgba(124, 58, 237, 0.3);
    }

    .btn-primary {
      background: linear-gradient(135deg, #7c3aed, #06b6d4);
      color: white;
      box-shadow: 0 4px 20px rgba(124, 58, 237, 0.4);
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 30px rgba(124, 58, 237, 0.6);
    }

    .btn-primary:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
    }

    .main-content {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }

    .auth-container {
      width: 100%;
      max-width: 420px;
    }

    .auth-card {
      background: rgba(20, 20, 40, 0.8);
      backdrop-filter: blur(20px);
      border: 1px solid rgba(124, 58, 237, 0.3);
      border-radius: 24px;
      padding: 40px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
    }

    .auth-title {
      font-size: 28px;
      font-weight: 700;
      text-align: center;
      margin-bottom: 8px;
    }

    .auth-subtitle {
      color: rgba(255, 255, 255, 0.6);
      text-align: center;
      margin-bottom: 32px;
      font-size: 14px;
    }

    .form-group {
      margin-bottom: 20px;
    }

    .form-label {
      display: block;
      color: rgba(255, 255, 255, 0.8);
      font-size: 14px;
      font-weight: 500;
      margin-bottom: 8px;
    }

    .form-input {
      width: 100%;
      padding: 14px 16px;
      background: rgba(255, 255, 255, 0.05);
      border: 2px solid rgba(124, 58, 237, 0.2);
      border-radius: 12px;
      color: white;
      font-size: 16px;
      font-family: inherit;
      transition: all 0.3s ease;
    }

    .form-input::placeholder {
      color: rgba(255, 255, 255, 0.3);
    }

    .form-input:focus {
      outline: none;
      border-color: #7c3aed;
      box-shadow: 0 0 20px rgba(124, 58, 237, 0.3);
      background: rgba(255, 255, 255, 0.08);
    }

    .submit-btn {
      width: 100%;
      padding: 16px;
      margin-top: 24px;
    }

    .auth-switch {
      text-align: center;
      margin-top: 24px;
      color: rgba(255, 255, 255, 0.6);
      font-size: 14px;
    }

    .auth-switch a {
      color: #7c3aed;
      text-decoration: none;
      font-weight: 600;
    }

    .auth-switch a:hover {
      text-decoration: underline;
    }

    .error-message {
      background: rgba(239, 68, 68, 0.1);
      border: 1px solid rgba(239, 68, 68, 0.3);
      color: #ef4444;
      padding: 12px 16px;
      border-radius: 12px;
      margin-bottom: 20px;
      font-size: 14px;
      display: none;
    }

    .success-message {
      background: rgba(34, 197, 94, 0.1);
      border: 1px solid rgba(34, 197, 94, 0.3);
      color: #22c55e;
      padding: 12px 16px;
      border-radius: 12px;
      margin-bottom: 20px;
      font-size: 14px;
      display: none;
    }

    .dashboard {
      display: none;
      width: 100%;
    }

    .dashboard-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 40px;
      flex-wrap: wrap;
      gap: 20px;
    }

    .welcome-text h1 {
      font-size: 32px;
      font-weight: 700;
      margin-bottom: 8px;
    }

    .welcome-text p {
      color: rgba(255, 255, 255, 0.6);
    }

    .director-key-card {
      background: linear-gradient(135deg, rgba(124, 58, 237, 0.2), rgba(6, 182, 212, 0.2));
      border: 2px solid rgba(124, 58, 237, 0.4);
      border-radius: 20px;
      padding: 24px 32px;
      display: flex;
      align-items: center;
      gap: 20px;
      box-shadow: 0 0 40px rgba(124, 58, 237, 0.2);
    }

    .key-icon {
      width: 56px;
      height: 56px;
      background: linear-gradient(135deg, #7c3aed, #06b6d4);
      border-radius: 14px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 28px;
    }

    .key-info h3 {
      font-size: 14px;
      color: rgba(255, 255, 255, 0.6);
      font-weight: 500;
      margin-bottom: 4px;
    }

    .key-value {
      font-size: 24px;
      font-weight: 700;
      font-family: 'Courier New', monospace;
      color: #7c3aed;
      letter-spacing: 2px;
    }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-bottom: 40px;
    }

    .stat-card {
      background: rgba(20, 20, 40, 0.6);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(124, 58, 237, 0.2);
      border-radius: 16px;
      padding: 24px;
    }

    .stat-value {
      font-size: 36px;
      font-weight: 700;
      color: #7c3aed;
      margin-bottom: 8px;
    }

    .stat-label {
      color: rgba(255, 255, 255, 0.6);
      font-size: 14px;
    }

    .section-title {
      font-size: 24px;
      font-weight: 700;
      margin-bottom: 24px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .codes-table {
      background: rgba(20, 20, 40, 0.6);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(124, 58, 237, 0.2);
      border-radius: 16px;
      overflow: hidden;
    }

    .table-header {
      display: grid;
      grid-template-columns: 1fr 1fr 1fr 1fr 100px;
      padding: 16px 24px;
      background: rgba(124, 58, 237, 0.1);
      border-bottom: 1px solid rgba(124, 58, 237, 0.2);
      font-weight: 600;
      font-size: 14px;
      color: rgba(255, 255, 255, 0.8);
    }

    .table-row {
      display: grid;
      grid-template-columns: 1fr 1fr 1fr 1fr 100px;
      padding: 16px 24px;
      border-bottom: 1px solid rgba(124, 58, 237, 0.1);
      align-items: center;
    }

    .table-row:last-child {
      border-bottom: none;
    }

    .code-badge {
      font-family: 'Courier New', monospace;
      font-weight: 600;
      color: #06b6d4;
      font-size: 16px;
    }

    .role-badge {
      display: inline-block;
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 600;
    }

    .role-student { background: rgba(34, 197, 94, 0.2); color: #22c55e; }
    .role-teacher { background: rgba(59, 130, 246, 0.2); color: #3b82f6; }
    .role-curator { background: rgba(168, 85, 247, 0.2); color: #a855f7; }

    .status-active {
      color: #22c55e;
    }

    .status-inactive {
      color: #ef4444;
    }

    .delete-btn {
      background: rgba(239, 68, 68, 0.2);
      border: none;
      color: #ef4444;
      padding: 8px 16px;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      font-size: 12px;
      transition: all 0.3s;
    }

    .delete-btn:hover {
      background: rgba(239, 68, 68, 0.4);
    }

    .empty-state {
      padding: 60px;
      text-align: center;
      color: rgba(255, 255, 255, 0.4);
    }

    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.8);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 1000;
    }

    .modal-content {
      background: rgba(20, 20, 40, 0.95);
      backdrop-filter: blur(20px);
      border: 1px solid rgba(124, 58, 237, 0.3);
      border-radius: 24px;
      padding: 40px;
      width: 100%;
      max-width: 420px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
    }

    .modal-title {
      font-size: 24px;
      font-weight: 700;
      margin-bottom: 24px;
      text-align: center;
    }

    .modal-close {
      position: absolute;
      top: 16px;
      right: 16px;
      background: none;
      border: none;
      color: rgba(255, 255, 255, 0.5);
      font-size: 24px;
      cursor: pointer;
    }

    .modal-buttons {
      display: flex;
      gap: 12px;
      margin-top: 24px;
    }

    .modal-buttons .btn {
      flex: 1;
    }

    select.form-input {
      cursor: pointer;
      appearance: none;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='%237c3aed' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6,9 12,15 18,9'%3E%3C/polyline%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: right 12px center;
      background-size: 16px;
    }

    @media (max-width: 768px) {
      .header {
        flex-direction: column;
        gap: 20px;
      }
      
      .table-header, .table-row {
        grid-template-columns: 1fr 1fr;
        gap: 8px;
      }
      
      .table-header > *:nth-child(n+3),
      .table-row > *:nth-child(n+3) {
        display: none;
      }
    }
  </style>
</head>
<body>
  <div class="background-orbs">
    <div class="orb orb-1"></div>
    <div class="orb orb-2"></div>
    <div class="orb orb-3"></div>
  </div>

  <div class="container">
    <header class="header">
      <div class="logo">
        <div class="logo-icon">&#x2728;</div>
        <span class="logo-text">Луч Знаний</span>
      </div>
      <div class="nav-buttons" id="authButtons">
        <button class="btn btn-outline" onclick="showLoginForm()">Войти</button>
        <button class="btn btn-primary" onclick="showRegisterForm()">Регистрация</button>
      </div>
      <div class="nav-buttons" id="userButtons" style="display: none;">
        <span id="userName" style="color: rgba(255,255,255,0.7); margin-right: 12px;"></span>
        <button class="btn btn-outline" onclick="logout()">Выйти</button>
      </div>
    </header>

    <main class="main-content">
      <div class="auth-container" id="authContainer">
        <div class="auth-card" id="loginCard">
          <h2 class="auth-title">Вход в систему</h2>
          <p class="auth-subtitle">Войдите для управления инвайт-кодами</p>
          
          <div class="error-message" id="loginError"></div>
          
          <form id="loginForm" onsubmit="handleLogin(event)">
            <div class="form-group">
              <label class="form-label">Email</label>
              <input type="email" class="form-input" id="loginEmail" placeholder="director@school.ru" required>
            </div>
            <div class="form-group">
              <label class="form-label">Пароль</label>
              <input type="password" class="form-input" id="loginPassword" placeholder="Введите пароль" required>
            </div>
            <button type="submit" class="btn btn-primary submit-btn" id="loginBtn">Войти</button>
          </form>
          
          <p class="auth-switch">
            Нет аккаунта? <a href="#" onclick="showRegisterForm()">Зарегистрируйтесь</a>
          </p>
        </div>

        <div class="auth-card" id="registerCard" style="display: none;">
          <h2 class="auth-title">Регистрация</h2>
          <p class="auth-subtitle">Создайте аккаунт директора школы</p>
          
          <div class="error-message" id="registerError"></div>
          <div class="success-message" id="registerSuccess"></div>
          
          <form id="registerForm" onsubmit="handleRegister(event)">
            <div class="form-group">
              <label class="form-label">ФИО директора</label>
              <input type="text" class="form-input" id="regName" placeholder="Иванов Иван Иванович" required>
            </div>
            <div class="form-group">
              <label class="form-label">Название школы</label>
              <input type="text" class="form-input" id="regSchool" placeholder="Лицей №1" required>
            </div>
            <div class="form-group">
              <label class="form-label">Email</label>
              <input type="email" class="form-input" id="regEmail" placeholder="director@school.ru" required>
            </div>
            <div class="form-group">
              <label class="form-label">Пароль</label>
              <input type="password" class="form-input" id="regPassword" placeholder="Минимум 6 символов" required minlength="6">
            </div>
            <button type="submit" class="btn btn-primary submit-btn" id="registerBtn">Зарегистрироваться</button>
          </form>
          
          <p class="auth-switch">
            Уже есть аккаунт? <a href="#" onclick="showLoginForm()">Войдите</a>
          </p>
        </div>
      </div>

      <div class="dashboard" id="dashboard">
        <div class="dashboard-header">
          <div class="welcome-text">
            <h1>Панель управления</h1>
            <p id="schoolName">Загрузка...</p>
          </div>
          <div class="director-key-card">
            <div class="key-icon">&#x1F511;</div>
            <div class="key-info">
              <h3>Ваш ключ директора</h3>
              <div class="key-value" id="directorKey">---</div>
            </div>
          </div>
        </div>

        <div class="stats-grid">
          <div class="stat-card">
            <div class="stat-value" id="totalCodes">0</div>
            <div class="stat-label">Создано кодов</div>
          </div>
          <div class="stat-card">
            <div class="stat-value" id="activeCodes">0</div>
            <div class="stat-label">Активных</div>
          </div>
          <div class="stat-card">
            <div class="stat-value" id="totalUsage">0</div>
            <div class="stat-label">Использований</div>
          </div>
        </div>

        <div class="section-title">
          <span>Инвайт-коды</span>
          <button class="btn btn-primary" onclick="openCreateModal()">+ Создать код</button>
        </div>

        <div class="codes-table">
          <div class="table-header">
            <div>Код</div>
            <div>Класс</div>
            <div>Роль</div>
            <div>Статус</div>
            <div>Действия</div>
          </div>
          <div id="codesBody">
            <div class="empty-state">Нет созданных кодов</div>
          </div>
        </div>
      </div>
    </main>
  </div>

  <div class="modal-overlay" id="createModal">
    <div class="modal-content">
      <h3 class="modal-title">Создать инвайт-код</h3>
      
      <div class="error-message" id="createError"></div>
      
      <form id="createCodeForm" onsubmit="handleCreateCode(event)">
        <div class="form-group">
          <label class="form-label">Класс</label>
          <input type="text" class="form-input" id="codeClass" placeholder="9А" required>
        </div>
        <div class="form-group">
          <label class="form-label">Роль</label>
          <select class="form-input" id="codeRole" required>
            <option value="student">Ученик</option>
            <option value="teacher">Учитель</option>
            <option value="curator">Куратор</option>
          </select>
        </div>
        <div class="modal-buttons">
          <button type="button" class="btn btn-outline" onclick="closeCreateModal()">Отмена</button>
          <button type="submit" class="btn btn-primary" id="createBtn">Создать</button>
        </div>
      </form>
    </div>
  </div>

  <script>
    let currentUser = null;
    let inviteCodes = [];

    function showLoginForm() {
      document.getElementById('loginCard').style.display = 'block';
      document.getElementById('registerCard').style.display = 'none';
      clearErrors();
    }

    function showRegisterForm() {
      document.getElementById('loginCard').style.display = 'none';
      document.getElementById('registerCard').style.display = 'block';
      clearErrors();
    }

    function clearErrors() {
      document.querySelectorAll('.error-message, .success-message').forEach(el => {
        el.style.display = 'none';
        el.textContent = '';
      });
    }

    function showError(elementId, message) {
      const el = document.getElementById(elementId);
      el.textContent = message;
      el.style.display = 'block';
    }

    function showSuccess(elementId, message) {
      const el = document.getElementById(elementId);
      el.textContent = message;
      el.style.display = 'block';
    }

    async function handleRegister(e) {
      e.preventDefault();
      clearErrors();
      
      const btn = document.getElementById('registerBtn');
      btn.disabled = true;
      btn.textContent = 'Регистрация...';

      try {
        const response = await fetch('/api/auth/register', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            name: document.getElementById('regName').value,
            schoolName: document.getElementById('regSchool').value,
            email: document.getElementById('regEmail').value,
            password: document.getElementById('regPassword').value
          })
        });

        const data = await response.json();

        if (!response.ok) {
          throw new Error(data.error || 'Ошибка регистрации');
        }

        showSuccess('registerSuccess', 'Регистрация успешна! Ваш ключ директора: ' + data.directorKey);
        document.getElementById('registerForm').reset();
        
        setTimeout(() => {
          showLoginForm();
        }, 3000);

      } catch (error) {
        showError('registerError', error.message);
      } finally {
        btn.disabled = false;
        btn.textContent = 'Зарегистрироваться';
      }
    }

    async function handleLogin(e) {
      e.preventDefault();
      clearErrors();
      
      const btn = document.getElementById('loginBtn');
      btn.disabled = true;
      btn.textContent = 'Вход...';

      try {
        const response = await fetch('/api/auth/login', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            email: document.getElementById('loginEmail').value,
            password: document.getElementById('loginPassword').value
          })
        });

        const data = await response.json();

        if (!response.ok) {
          throw new Error(data.error || 'Ошибка входа');
        }

        currentUser = data.user;
        localStorage.setItem('authToken', data.token);
        localStorage.setItem('user', JSON.stringify(data.user));
        
        showDashboard();

      } catch (error) {
        showError('loginError', error.message);
      } finally {
        btn.disabled = false;
        btn.textContent = 'Войти';
      }
    }

    function showDashboard() {
      document.getElementById('authContainer').style.display = 'none';
      document.getElementById('dashboard').style.display = 'block';
      document.getElementById('authButtons').style.display = 'none';
      document.getElementById('userButtons').style.display = 'flex';
      
      document.getElementById('userName').textContent = currentUser.name;
      document.getElementById('schoolName').textContent = currentUser.schoolName;
      document.getElementById('directorKey').textContent = currentUser.directorKey;
      
      loadInviteCodes();
    }

    function logout() {
      currentUser = null;
      localStorage.removeItem('authToken');
      localStorage.removeItem('user');
      
      document.getElementById('authContainer').style.display = 'block';
      document.getElementById('dashboard').style.display = 'none';
      document.getElementById('authButtons').style.display = 'flex';
      document.getElementById('userButtons').style.display = 'none';
      
      showLoginForm();
    }

    async function loadInviteCodes() {
      try {
        const token = localStorage.getItem('authToken');
        const response = await fetch('/api/invite-codes', {
          headers: { 'Authorization': 'Bearer ' + token }
        });

        if (!response.ok) {
          if (response.status === 401) {
            logout();
            return;
          }
          throw new Error('Ошибка загрузки');
        }

        inviteCodes = await response.json();
        renderCodes();
        updateStats();

      } catch (error) {
        console.error('Error loading codes:', error);
      }
    }

    function renderCodes() {
      const body = document.getElementById('codesBody');
      
      if (inviteCodes.length === 0) {
        body.innerHTML = '<div class="empty-state">Нет созданных кодов</div>';
        return;
      }

      body.innerHTML = inviteCodes.map(code => `
        <div class="table-row">
          <div class="code-badge">${code.code}</div>
          <div>${code.className}</div>
          <div><span class="role-badge role-${code.role}">${getRoleLabel(code.role)}</span></div>
          <div class="${code.isActive ? 'status-active' : 'status-inactive'}">
            ${code.isActive ? 'Активен' : 'Неактивен'}
          </div>
          <div>
            <button class="delete-btn" onclick="deleteCode('${code.id}')">Удалить</button>
          </div>
        </div>
      `).join('');
    }

    function getRoleLabel(role) {
      const labels = {
        student: 'Ученик',
        teacher: 'Учитель',
        curator: 'Куратор'
      };
      return labels[role] || role;
    }

    function updateStats() {
      document.getElementById('totalCodes').textContent = inviteCodes.length;
      document.getElementById('activeCodes').textContent = inviteCodes.filter(c => c.isActive).length;
      document.getElementById('totalUsage').textContent = inviteCodes.reduce((sum, c) => sum + parseInt(c.usageCount || 0), 0);
    }

    function openCreateModal() {
      document.getElementById('createModal').style.display = 'flex';
      clearErrors();
    }

    function closeCreateModal() {
      document.getElementById('createModal').style.display = 'none';
      document.getElementById('createCodeForm').reset();
    }

    async function handleCreateCode(e) {
      e.preventDefault();
      clearErrors();
      
      const btn = document.getElementById('createBtn');
      btn.disabled = true;
      btn.textContent = 'Создание...';

      try {
        const token = localStorage.getItem('authToken');
        const response = await fetch('/api/invite-codes', {
          method: 'POST',
          headers: { 
            'Content-Type': 'application/json',
            'Authorization': 'Bearer ' + token
          },
          body: JSON.stringify({
            className: document.getElementById('codeClass').value,
            role: document.getElementById('codeRole').value
          })
        });

        const data = await response.json();

        if (!response.ok) {
          throw new Error(data.error || 'Ошибка создания');
        }

        closeCreateModal();
        loadInviteCodes();

      } catch (error) {
        showError('createError', error.message);
      } finally {
        btn.disabled = false;
        btn.textContent = 'Создать';
      }
    }

    async function deleteCode(codeId) {
      if (!confirm('Удалить этот инвайт-код?')) return;

      try {
        const token = localStorage.getItem('authToken');
        const response = await fetch('/api/invite-codes/' + codeId, {
          method: 'DELETE',
          headers: { 'Authorization': 'Bearer ' + token }
        });

        if (!response.ok) {
          throw new Error('Ошибка удаления');
        }

        loadInviteCodes();

      } catch (error) {
        alert(error.message);
      }
    }

    window.addEventListener('load', () => {
      const token = localStorage.getItem('authToken');
      const userJson = localStorage.getItem('user');
      
      if (token && userJson) {
        try {
          currentUser = JSON.parse(userJson);
          showDashboard();
        } catch {
          logout();
        }
      }
    });

    document.getElementById('createModal').addEventListener('click', (e) => {
      if (e.target === document.getElementById('createModal')) {
        closeCreateModal();
      }
    });
  </script>
</body>
</html>
